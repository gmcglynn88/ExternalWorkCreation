async function createInteraction(token) {
  const queueId = document.getElementById('queueSelect').value;
  const userId = document.getElementById('userSelect').value;
  const externalReference = document.getElementById('externalReference').value;
  const mediaType = document.getElementById('mediaTypeSelect').value; // Get selected media type

  // Determine API endpoint based on the selected media type
  let apiEndpoint = '';
  switch (mediaType) {
    case 'voice':
      apiEndpoint = 'https://api.mypurecloud.ie/api/v2/conversations/calls';
      break;
    case 'email':
      apiEndpoint = 'https://api.mypurecloud.ie/api/v2/conversations/emails';
      break;
    case 'message':
      apiEndpoint = 'https://api.mypurecloud.ie/api/v2/conversations/messages';
      break;
    case 'chat':
      apiEndpoint = 'https://api.mypurecloud.ie/api/v2/conversations/chats';
      break;
    default:
      console.error('Invalid media type selected');
      return;
  }

  try {
    const interactionResponse = await fetch(apiEndpoint, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        queueId: queueId,
        provider: 'QualityForm',
        direction: 'INBOUND',
        fromName: 'External Work',
        attributes: { 'External Link': externalReference }
      })
    });

    if (!interactionResponse.ok) {
      throw new Error(`Error creating interaction: ${interactionResponse.status} ${interactionResponse.statusText}`);
    }

    const interaction = await interactionResponse.json();
    const conversationId = interaction.id;

    const conversationDetailsResponse = await fetch(`https://api.mypurecloud.ie/api/v2/conversations/${conversationId}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    if (!conversationDetailsResponse.ok) {
      throw new Error(`Error fetching conversation details: ${conversationDetailsResponse.status} ${conversationDetailsResponse.statusText}`);
    }
    const conversationDetails = await conversationDetailsResponse.json();
    const participantId = conversationDetails.participants[1].id;

    const assignResponse = await fetch(`${apiEndpoint}/${conversationId}/participants/${participantId}/replace`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId: userId })
    });

    if (!assignResponse.ok) {
      throw new Error(`Error assigning user: ${assignResponse.status} ${assignResponse.statusText}`);
    }

    const disconnectResponse = await fetch(`${apiEndpoint}/${conversationId}`, {
      method: 'PATCH',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ state: 'disconnected' })
    });

    if (!disconnectResponse.ok) {
      throw new Error(`Error disconnecting conversation: ${disconnectResponse.status} ${disconnectResponse.statusText}`);
    }

    document.getElementById('statusMessage').innerText = 'Interaction created and assigned successfully!';

  } catch (error) {
    console.error('Error during interaction creation:', error);
    document.getElementById('statusMessage').innerText = `Error: ${error.message}`;
  }
}
